<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 800" width="1200" height="800">
  <defs>
    <linearGradient id="bgGrad3" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#1a1a2e;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#16213e;stop-opacity:1" />
    </linearGradient>
    <filter id="shadow3">
      <feDropShadow dx="0" dy="4" stdDeviation="6" flood-color="#000" flood-opacity="0.4"/>
    </filter>
    <marker id="arrow3" markerWidth="12" markerHeight="8" refX="10" refY="4" orient="auto">
      <polygon points="0 0, 12 4, 0 8" fill="#00ffa3"/>
    </marker>
  </defs>
  
  <rect width="1200" height="800" fill="url(#bgGrad3)"/>
  
  <!-- Title -->
  <text x="600" y="40" text-anchor="middle" font-family="Arial, sans-serif" font-size="26" font-weight="bold" fill="#00ffa3">
    Sentiment Analysis Pipeline Architecture
  </text>
  <text x="600" y="65" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" fill="#9aa9b3">
    FinBERT Transformer with VADER Fallback
  </text>

  <!-- NEWS SOURCES -->
  <g id="news-sources" transform="translate(50, 100)">
    <text x="140" y="0" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#00ffa3">News Sources</text>
    
    <rect x="0" y="20" width="280" height="60" rx="10" fill="#0f3460" stroke="#4ade80" stroke-width="2"/>
    <text x="140" y="45" text-anchor="middle" font-family="Arial, sans-serif" font-size="13" font-weight="bold" fill="#4ade80">Upstox News API</text>
    <text x="140" y="65" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#9aa9b3">Priority 1 - Direct Broker Integration</text>
    
    <rect x="0" y="95" width="280" height="60" rx="10" fill="#0f3460" stroke="#60a5fa" stroke-width="2"/>
    <text x="140" y="120" text-anchor="middle" font-family="Arial, sans-serif" font-size="13" font-weight="bold" fill="#60a5fa">NewsAPI.org</text>
    <text x="140" y="140" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#9aa9b3">Priority 2 - Global News Aggregation</text>
    
    <rect x="0" y="170" width="280" height="60" rx="10" fill="#0f3460" stroke="#f472b6" stroke-width="2"/>
    <text x="140" y="195" text-anchor="middle" font-family="Arial, sans-serif" font-size="13" font-weight="bold" fill="#f472b6">yfinance News</text>
    <text x="140" y="215" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#9aa9b3">Priority 3 - Yahoo Finance Fallback</text>
  </g>

  <!-- Arrow from sources -->
  <path d="M 330,200 L 420,200" stroke="#00ffa3" stroke-width="2" marker-end="url(#arrow3)"/>

  <!-- TEXT PREPROCESSING -->
  <g id="preprocessing" transform="translate(420, 140)">
    <rect x="0" y="0" width="200" height="120" rx="15" fill="#0f3460" stroke="#fbbf24" stroke-width="2" filter="url(#shadow3)"/>
    <text x="100" y="30" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#fbbf24">Text Preprocessing</text>
    <text x="100" y="55" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#9aa9b3">• Title + Summary</text>
    <text x="100" y="75" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#9aa9b3">• Concatenation</text>
    <text x="100" y="95" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#9aa9b3">• Cleaning/Normalization</text>
  </g>

  <!-- Arrow to model selection -->
  <path d="M 620,200 L 710,200" stroke="#00ffa3" stroke-width="2" marker-end="url(#arrow3)"/>

  <!-- MODEL SELECTION -->
  <g id="model-selection" transform="translate(710, 90)">
    <rect x="0" y="0" width="440" height="340" rx="15" fill="#0f3460" stroke="#00ffa3" stroke-width="2" filter="url(#shadow3)"/>
    <text x="220" y="30" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#00ffa3">Model Selection</text>
    
    <!-- FinBERT -->
    <rect x="20" y="50" width="400" height="130" rx="10" fill="#1a1a2e" stroke="#4ade80" stroke-width="2"/>
    <text x="220" y="75" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#4ade80">Priority 1: FinBERT Transformer</text>
    <text x="220" y="100" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#9aa9b3">Model: yiyanghkust/finbert-tone</text>
    <text x="220" y="120" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#9aa9b3">Architecture: BERT-base + Financial Fine-tuning</text>
    <text x="220" y="140" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#9aa9b3">Labels: Positive / Neutral / Negative</text>
    <text x="220" y="160" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#9aa9b3">Accuracy: 84.2% | Latency: ~145ms</text>
    
    <!-- Fallback indicator -->
    <path d="M 220,185 L 220,205" stroke="#fbbf24" stroke-width="2" stroke-dasharray="4"/>
    <text x="220" y="218" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#fbbf24">[if unavailable]</text>
    
    <!-- VADER -->
    <rect x="20" y="230" width="400" height="95" rx="10" fill="#1a1a2e" stroke="#60a5fa" stroke-width="2"/>
    <text x="220" y="255" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#60a5fa">Priority 2: VADER Lexicon</text>
    <text x="220" y="280" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#9aa9b3">Library: nltk.sentiment.vader</text>
    <text x="220" y="300" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#9aa9b3">Approach: Rule-based with intensifiers</text>
    <text x="220" y="320" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#9aa9b3">Accuracy: 71.5% | Latency: ~8ms</text>
  </g>

  <!-- SCORE AGGREGATION -->
  <g id="aggregation" transform="translate(420, 460)">
    <rect x="0" y="0" width="500" height="120" rx="15" fill="#0f3460" stroke="#f472b6" stroke-width="2" filter="url(#shadow3)"/>
    <text x="250" y="30" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#f472b6">Score Aggregation</text>
    
    <text x="250" y="60" text-anchor="middle" font-family="Courier New, monospace" font-size="14" fill="#e0e0e0">
      S_final = (1/n) × Σ s_i
    </text>
    <text x="250" y="85" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#9aa9b3">
      Mean sentiment across all news items
    </text>
    <text x="250" y="105" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#9aa9b3">
      Output Range: [-1.0, +1.0]
    </text>
  </g>

  <!-- Arrows to aggregation -->
  <path d="M 930,430 L 930,480 L 920,480" stroke="#00ffa3" stroke-width="2" marker-end="url(#arrow3)"/>

  <!-- OUTPUT -->
  <g id="output" transform="translate(420, 610)">
    <rect x="0" y="0" width="500" height="100" rx="15" fill="#0f3460" stroke="#00ffa3" stroke-width="2" filter="url(#shadow3)"/>
    <text x="250" y="30" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#00ffa3">Sentiment Output</text>
    
    <g transform="translate(40, 45)">
      <rect x="0" y="0" width="120" height="40" rx="5" fill="#ff6b6b" opacity="0.3"/>
      <text x="60" y="25" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#ff6b6b">Negative</text>
      <text x="60" y="45" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#9aa9b3">[-1.0, -0.2]</text>
    </g>
    
    <g transform="translate(190, 45)">
      <rect x="0" y="0" width="120" height="40" rx="5" fill="#fbbf24" opacity="0.3"/>
      <text x="60" y="25" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#fbbf24">Neutral</text>
      <text x="60" y="45" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#9aa9b3">[-0.2, +0.2]</text>
    </g>
    
    <g transform="translate(340, 45)">
      <rect x="0" y="0" width="120" height="40" rx="5" fill="#4ade80" opacity="0.3"/>
      <text x="60" y="25" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#4ade80">Positive</text>
      <text x="60" y="45" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#9aa9b3">[+0.2, +1.0]</text>
    </g>
  </g>

  <!-- Arrow from aggregation to output -->
  <path d="M 670,580 L 670,610" stroke="#00ffa3" stroke-width="2" marker-end="url(#arrow3)"/>

  <!-- FINBERT SCORING DETAIL -->
  <g id="finbert-detail" transform="translate(50, 460)">
    <rect x="0" y="0" width="340" height="250" rx="15" fill="#0f3460" stroke="#4ade80" stroke-width="2" filter="url(#shadow3)"/>
    <text x="170" y="30" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#4ade80">FinBERT Score Mapping</text>
    
    <text x="20" y="60" font-family="Courier New, monospace" font-size="11" fill="#e0e0e0">Label: "Positive" → Score = +confidence</text>
    <text x="20" y="85" font-family="Courier New, monospace" font-size="11" fill="#e0e0e0">Label: "Negative" → Score = -confidence</text>
    <text x="20" y="110" font-family="Courier New, monospace" font-size="11" fill="#e0e0e0">Label: "Neutral"  → Score = 0.0</text>
    
    <line x1="20" y1="125" x2="320" y2="125" stroke="#4ade80" stroke-width="1" opacity="0.3"/>
    
    <text x="170" y="150" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#9aa9b3">Example Processing:</text>
    
    <text x="20" y="175" font-family="Arial, sans-serif" font-size="10" fill="#9aa9b3">Input: "RELIANCE posts strong quarterly earnings"</text>
    <text x="20" y="195" font-family="Arial, sans-serif" font-size="10" fill="#9aa9b3">→ Tokenize (max 512 tokens)</text>
    <text x="20" y="215" font-family="Arial, sans-serif" font-size="10" fill="#9aa9b3">→ FinBERT Inference (GPU/CPU)</text>
    <text x="20" y="235" font-family="Arial, sans-serif" font-size="10" fill="#4ade80">→ Output: {"label": "Positive", "score": 0.92}</text>
  </g>
</svg>
